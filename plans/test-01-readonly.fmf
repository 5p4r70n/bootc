# Run this via `make test-tmt` which will build a container,
# and a disk image from it.
provision:
  how: virtual
  # Generated by make test-tmt
  image: file://./target/testvm/disk.qcow2
  disk: 20
summary: Execute booted readonly/nondestructive tests
execute:
  how: tmt
  # We currently write tests in nushell. It is is quite nice for running subprocesses
  # and the like while making it easy to parse JSON etc.
  # All of these tests should generally be read-only - avoid any kind
  # of persistent changes.
  # If you need to do that, unfortunately right now that needs to be
  # a separate plan.
  script: |
    set -xeu
    ls tests/booted/readonly/*-test-*.nu |sort -n | while read t; do nu $t; done
